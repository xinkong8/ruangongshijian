# ROS2 节点 README 文档

## 节点名称
### 服务端节点
**minimal_service**

### 客户端节点
**minimal_client_async**

## 功能描述
### 服务端节点
该服务端节点的主要功能是提供一个服务，用于保存地图数据。它接收客户端发送的地图名称，生成唯一的地图ID，将地图信息存储到SQLite数据库中，并使用`map_saver_cli`工具将地图数据保存到指定路径。

### 客户端节点
该客户端节点的主要功能是向服务端节点发送地图保存请求。它通过服务调用将指定的地图名称发送给服务端，并接收服务端的响应。

## 订阅的接口
### 服务端节点
- **服务名称**：`yahboomAppSaveMap`
- **服务类型**：`yahboom_web_savmap_interfaces/srv/WebSaveMap`
- **回调函数**：`add_three_ints_callback`

### 客户端节点
- **服务名称**：`add_three_ints`
- **服务类型**：`yahboom_web_savmap_interfaces/srv/WebSaveMap`
- **请求发送函数**：`send_request`

## 发布的接口
### 服务端节点
- **服务响应**：通过服务响应返回处理结果。

### 客户端节点
- **服务请求**：通过服务请求发送地图名称。

## 其他信息

### 服务端节点的代码中的问题
1. **服务名称不匹配**：
   - 在服务端节点中，服务名称被设置为`yahboomAppSaveMap`，但在客户端节点中，服务名称被设置为`add_three_ints`，这会导致服务调用失败。

2. **异常处理不够完善**：
   - 在数据库操作和外部命令执行过程中，异常处理不够全面，可能导致在出现错误时无法正确记录问题。

3. **日志输出不够详细**：
   - 在服务回调函数中，日志输出不够详细，无法方便地监控服务的处理过程。

4. **硬编码路径和参数**：
   - 地图保存路径和数据库路径被硬编码在代码中，这在不同环境下可能需要修改代码，降低了可移植性。

### 客户端节点的代码中的问题
1. **服务名称不匹配**：
   - 客户端节点中服务名称被设置为`add_three_ints`，与服务端节点的服务名称不一致，这会导致服务调用失败。

2. **请求参数硬编码**：
   - 地图名称被硬编码为`"mapssss"`，这在实际使用中可能需要根据用户输入动态设置。

3. **缺少错误处理**：
   - 在服务调用过程中，缺少对可能发生的错误的处理，可能导致程序在出现异常时崩溃。

### 修改建议
#### 服务端节点
1. **修正服务名称**：
   - 将服务名称改为一致，例如`yahboomAppSaveMap`，以确保客户端能够正确调用服务。

2. **完善异常处理**：
   - 在数据库操作和外部命令执行时，添加更详细的异常处理和日志记录，方便调试和问题定位。

3. **优化日志输出**：
   - 在服务回调函数中添加更多的日志信息，记录每个关键步骤的执行情况。

4. **参数化路径和配置**：
   - 将地图保存路径和数据库路径参数化，通过参数服务器或配置文件进行设置，提高代码的可移植性。

#### 客户端节点
1. **修正服务名称**：
   - 将服务名称改为与服务端一致，例如`yahboomAppSaveMap`，以确保能够正确调用服务。

2. **动态设置请求参数**：
   - 通过命令行参数或参数服务器动态设置地图名称，而不是硬编码。

3. **添加错误处理**：
   - 在服务调用过程中添加错误处理逻辑，确保在出现异常时能够正确处理并记录错误信息。

### 使用说明
#### 运行服务端节点
1. **确保ROS2环境已正确配置**，并安装了必要的依赖项。
2. **运行节点**：
   ```bash
   ros2 run <package_name> yahboom_app_save_map.py
   ```

#### 运行客户端节点
1. **确保ROS2环境已正确配置**，并安装了必要的依赖项。
2. **运行节点**：
   ```bash
   ros2 run <package_name> yahboom_app_save_map_client.py
   ```

#### 验证节点功能
1. **服务端节点**：
   - 使用`ros2 service list`命令查看服务是否已正确注册。
   - 使用`ros2 service type <service_name>`命令查看服务类型。

2. **客户端节点**：
   - 运行客户端节点后，检查服务端节点的日志输出，确保请求被正确处理。
   - 使用`ros2 service call <service_name> <service_type> '<request_data>'`命令手动调用服务，验证服务功能。

### 示例
#### 服务端节点示例
```bash
ros2 run <package_name> yahboom_app_save_map.py
```

#### 客户端节点示例
```bash
ros2 run <package_name> yahboom_app_save_map_client.py
```

通过以上修改和优化，可以提高节点的稳定性和可维护性，使其更好地适应实际应用需求。